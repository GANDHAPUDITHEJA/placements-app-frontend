<div class="max-w-4xl mx-auto mt-10 bg-white p-6 rounded-lg shadow-md flex flex-col md:flex-row gap-6">
    <!-- Left: Job Opening Details -->
    <div class="w-full md:w-1/2 p-4 border-b md:border-r md:border-b-0">
        <h2 class="text-2xl font-bold text-gray-700 mb-2" data-bind="text: jobTitle"></h2>
        <h3 class="text-xl font-semibold text-gray-600 mb-2" data-bind="text: companyName"></h3>
        <p class="text-gray-700 mb-4" data-bind="text: description"></p>
        <p class="text-gray-500"><strong>Last Date to Apply:</strong> <span data-bind="text: lastDate"></span></p>
    </div>

    <!-- Right: Resume Upload Form -->
    <div class="w-full md:w-1/2 p-4 flex flex-col items-center">
        <h2 class="text-xl font-bold text-gray-700 mb-4">Upload Your Resume</h2>

        <div class="w-full max-w-xs relative border-2 border-gray-300 border-dashed rounded-lg p-6 text-center" id="dropzone">
            <input type="file" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" id="file-upload"/>
            <div>
                <img class="mx-auto h-12 w-12" src="https://www.svgrepo.com/show/357902/image-upload.svg" alt="Upload Icon">
                <h3 class="mt-2 text-sm font-medium text-gray-900">
                    <span>Drag and drop</span>
                    <span class="text-indigo-600"> or browse</span>
                    <span> to upload</span>
                </h3>
                <p class="mt-1 text-xs text-gray-500">PDF, DOCX up to 10MB</p>
            </div>
            <p class="mt-2 text-sm text-gray-600" data-bind="text: resumeName"></p>
            <img src="" class="mt-4 mx-auto max-h-40 hidden" id="preview">
        </div>

        <button class="mt-4 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-700 w-full max-w-xs"
            data-bind="click: uploadResume">
            Submit Application
        </button>
    </div>
</div>


<script src="/javascripts/knockout.js"></script>
<script>
    function ApplyViewModel() {
        var self = this;

        // Job Opening Details
        self.jobTitle = ko.observable("");
        self.companyName = ko.observable("");
        self.description = ko.observable("");
        self.lastDate = ko.observable("");
        self.resumeName = ko.observable("No file selected");

        // Get openingId from URL
        const urlParams = new URLSearchParams(window.location.search);
        const openingId = urlParams.get("openingId");

        // Fetch job details
        fetch(`https://localhost:7209/api/Opening/${openingId}`)
            .then(response => response.json())
            .then(data => {
                self.jobTitle(data.jobTitle);
                self.companyName(data.companyName);
                self.description(data.description);
                self.lastDate(data.lastDate);
            })
            .catch(error => console.error("Error fetching job details:", error));

        // Handle file selection
        self.onFileSelect = function (event) {
            const file = event.target.files[0];
            if (file) self.resumeName(file.name);
        };

        document.getElementById('file-upload').addEventListener('change', self.onFileSelect);

        // Drag & Drop Handlers
        const dropzone = document.getElementById('dropzone');
        dropzone.addEventListener('dragover', e => {
            e.preventDefault();
            dropzone.classList.add('border-indigo-600');
        });

        dropzone.addEventListener('dragleave', () => dropzone.classList.remove('border-indigo-600'));

        dropzone.addEventListener('drop', e => {
            e.preventDefault();
            dropzone.classList.remove('border-indigo-600');
            const file = e.dataTransfer.files[0];
            if (file) {
                self.resumeName(file.name);
                document.getElementById('file-upload').files = e.dataTransfer.files;
            }
        });

        self.uploadResume = function () {
            alert("Resume Selected: " + self.resumeName());
        };
    }

    ko.applyBindings(new ApplyViewModel());
</script>
